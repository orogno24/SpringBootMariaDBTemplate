<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>거북이 키우기</title>
    <link rel="preload" href="/assets/img/019.png" as="image">
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="/css/bootstrap-responsive.css"/>
    <link rel="stylesheet" type="text/css" href="/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="/css/pluton.css"/>
    <link rel="stylesheet" type="text/css" href="/css/pluton-ie7.css"/>
    <link rel="stylesheet" type="text/css" href="/css/jquery.cslider.css"/>
    <link rel="stylesheet" type="text/css" href="/css/jquery.bxslider.css"/>
    <link rel="stylesheet" type="text/css" href="/css/animate.css"/>
    <link rel="icon" href="/assets/img/logo.png" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/img/logo.png" type="image/x-icon">
    <script type="text/javascript" src="/js/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/turtle.css"/>
    <style>

    </style>
    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#Button1").on("click", function () {
                doSubmit("#Button1", 1, 5);
            })

            $("#Button2").on("click", function () {
                doSubmit2();
            })

            $("#Button3").on("click", function () {
                doSubmit3();
            });

            $("#Button4").on("click", function () {
                doSubmit4();
            });
        })
        function doSubmit(buttonId, points, exp) {
            var button = $(buttonId);
            var lastClickTime = button.data('lastClickTime') || 0;
            var currentTime = new Date().getTime();

            if (currentTime - lastClickTime < 1000) { // 1초 간격으로 클릭 제한
                return;
            }

            button.data('lastClickTime', currentTime);
            button.prop('disabled', true); // 버튼 비활성화

            document.getElementById('hiddenPoint').value = points;
            document.getElementById('hiddenExp').value = exp;

            if ([[${rDTO.point}]] < points) {
                alert("포인트가 부족합니다.");
                button.prop('disabled', false); // 버튼 다시 활성화
                return;
            }

            $.ajax({
                url: "/user/expUpdate",
                type: "post",
                dataType: "JSON",
                data: $("#postureDataForm").serialize(),
                success: function (json) {
                    showHappyMessage();
                    addFeedEffect();
                },
                error: function (xhr, status, error) {
                    // 에러 처리
                },
                complete: function () {
                    button.prop('disabled', false); // AJAX 요청 완료 후 버튼 다시 활성화
                }
            });
        }

        function doSubmit2() {
            var button = $("#Button2");
            var lastClickTime = button.data('lastClickTime') || 0;
            var currentTime = new Date().getTime();

            if (currentTime - lastClickTime < 1000) { // 1초 간격으로 클릭 제한
                return;
            }

            button.data('lastClickTime', currentTime);
            button.prop('disabled', true); // 버튼 비활성화

            document.getElementById('hiddenPoint').value = 5;
            document.getElementById('hiddenExp').value = 25;

            if([[${rDTO.exp}]] < 15) {
                alert("2레벨부터 구매할 수 있는 아이템입니다.");
                return;
            }

            if ([[${rDTO.point}]] < 5) {
                alert("포인트가 부족합니다.");
                return;
            }

            // AJAX 요청을 통해 서버로 데이터를 전송합니다.
            $.ajax({
                url: "/user/expUpdate",
                type: "post",
                dataType: "JSON",
                data: $("#postureDataForm").serialize(),
                success: function (json) {
                    showHappyMessage2();
                    addFeedEffect2();
                },
                error: function (xhr, status, error) {
                    // 에러 처리
                },
                complete: function () {
                    button.prop('disabled', false); // AJAX 요청 완료 후 버튼 다시 활성화
                }
            });
        };

        function doSubmit3() {
            var button = $("#Button3");
            var lastClickTime = button.data('lastClickTime') || 0;
            var currentTime = new Date().getTime();

            if (currentTime - lastClickTime < 1000) { // 1초 간격으로 클릭 제한
                return;
            }

            button.data('lastClickTime', currentTime);
            button.prop('disabled', true); // 버튼 비활성화

            document.getElementById('hiddenPoint').value = 30;
            document.getElementById('hiddenExp').value = 150;

            if([[${rDTO.exp}]] < 60) {
                alert("3레벨부터 구매할 수 있는 아이템입니다.");
                return;
            }

            if ([[${rDTO.point}]] < 30) {
                alert("포인트가 부족합니다.");
                return;
            }

            // AJAX 요청을 통해 서버로 데이터를 전송합니다.
            $.ajax({
                url: "/user/expUpdate",
                type: "post",
                dataType: "JSON",
                data: $("#postureDataForm").serialize(),
                success: function (json) {
                    showHappyMessage3();
                    addFeedEffect3();
                },
                error: function (xhr, status, error) {
                    // 에러 처리
                },
                complete: function () {
                    button.prop('disabled', false); // AJAX 요청 완료 후 버튼 다시 활성화
                }
            });
        };

        function doSubmit4() {
            var button = $("#Button3");
            var lastClickTime = button.data('lastClickTime') || 0;
            var currentTime = new Date().getTime();

            if (currentTime - lastClickTime < 1000) { // 1초 간격으로 클릭 제한
                return;
            }

            button.data('lastClickTime', currentTime);
            button.prop('disabled', true); // 버튼 비활성화

            document.getElementById('hiddenPoint').value = 100;
            document.getElementById('hiddenExp').value = 500;

            if([[${rDTO.exp}]] < 300) {
                alert("4레벨부터 구매할 수 있는 아이템입니다.");
                return;
            }

            if ([[${rDTO.point}]] < 100) {
                alert("포인트가 부족합니다.");
                return;
            }

            // AJAX 요청을 통해 서버로 데이터를 전송합니다.
            $.ajax({
                url: "/user/expUpdate",
                type: "post",
                dataType: "JSON",
                data: $("#postureDataForm").serialize(),
                success: function (json) {
                    showHappyMessage4();
                    addFeedEffect4();
                },
                error: function (xhr, status, error) {
                    // 에러 처리
                },
                complete: function () {
                    button.prop('disabled', false); // AJAX 요청 완료 후 버튼 다시 활성화
                }
            });
        };

        function showHappyMessage() {
            var messageDiv = document.getElementById("turtleMessage");
            messageDiv.innerHTML = "거북이가 행복해합니다!<br>(+5 경험치!)";
            // 메시지를 표시하는 동안 클래스 추가하여 스타일 적용 가능
            messageDiv.classList.add("happyMessageStyle");
        }

        function showHappyMessage2() {
            var messageDiv = document.getElementById("turtleMessage");
            messageDiv.innerHTML = "거북이의 힘이 솟아오릅니다!<br>(+25 경험치!)";
            // 메시지를 표시하는 동안 클래스 추가하여 스타일 적용 가능
            messageDiv.classList.add("happyMessageStyle");
        }

        function showHappyMessage3() {
            var messageDiv = document.getElementById("turtleMessage");
            messageDiv.innerHTML = "거북이가 달콤한 맛에 즐거워합니다!<br>(+150 경험치!)";
            // 메시지를 표시하는 동안 클래스 추가하여 스타일 적용 가능
            messageDiv.classList.add("happyMessageStyle");
        }

        function showHappyMessage4() {
            var messageDiv = document.getElementById("turtleMessage");
            messageDiv.innerHTML = "수박을 먹고 거북이가 시원해합니다!<br>(+500 경험치!)";
            // 메시지를 표시하는 동안 클래스 추가하여 스타일 적용 가능
            messageDiv.classList.add("happyMessageStyle");
        }



    </script>
    <script src="/js/turtle.js"></script>
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const userName = /*[[${rDTO.userName}]]*/ 'defaultUserName';

            if (userName === null || userName === '' || userName === 'null') {
                alert("로그인 하시길 바랍니다.");
                window.location.href = '/user/login';
            }
        });
    </script>
</head>
<body>
<div id="screenEffect"></div>
<audio id="feedSound" src="/assets/img/eat.mp3"></audio>
<div class="navbar" style="border-bottom: 1px solid #15c6e5;">
    <div class="navbar-inner">
        <div class="container">
            <a href="/main" class="brand">
                <img src="/assets/img/logo3.png" width="170" height="41" alt="Logo">
                <!-- This is website logo -->
            </a>
            <!-- Navigation button, visible on small resolution -->
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <img src="/assets/img/logo5.png" width="30" height="30" alt="Logo">
            </button>
            <!-- Main navigation -->
            <div class="nav-collapse collapse pull-right">
                <ul class="nav" id="top-navigation">
                    <li class="active"><a href="#home">메인 페이지</a></li>
                    <li><a href="/gazami6">거북목 진단</a></li>
                    <li><a href="/gazami7">자세 모니터링</a></li>
                    <li><a href="/gazami8">통계</a></li>
                    <li><a href="/gazami9">커뮤니티</a></li>
                    <li><a href="/gazami3">프로필</a></li>
                    <li><span>&nbsp;&nbsp;</span></li>
                    <li><a href=""><span class="username-color">[[${userName}]]</span>님, 환영합니다!</a></li>
                </ul>
            </div>
            <!-- End main navigation -->
        </div>
    </div>
</div>
<div class="container" style="margin-top: 23px">
    <div class="title" style="border-bottom: 1px solid #FFF;">
        <h1>자세 개선 파트너</h1>
    </div>
    <div class="container centered" style="padding-top: 5px; margin-top: -20px">
        <p style="color: #ffffff; background-color: #31313a; border-radius: 5px">자세 모니터링에서 정상 자세를 유지하며 획득한 포인트로, 자신의 거북이를 성장시키세요!<br>
            더 많은 건강한 습관을 형성할수록, 거북이도 함께 성장합니다.</p>
    </div>
</div>
<section>
    <div class="content">
        <div class="item-list">
            <div class="item">
                <div class="item-info">
                    <div class="item-description">시금치</div>
                </div>
                <img class="item-img" src="/assets/img/food1.png" alt="아이템 1">

                <button id="Button1" class="item-button"><span style="color: #49ddfd">1</span> 포인트</button>
            </div>
            <div class="item">
                <div class="item-info">
                    <div class="item-description">브로콜리</div>
                </div>
                <img class="item-img2" src="/assets/img/food2.png" alt="아이템 2">

                <button id="Button2" class="item-button"><span style="color: #49ddfd">5</span> 포인트</button>
            </div>
            <div class="item">
                <div class="item-info">
                    <div class="item-description">샤인머스켓</div>
                </div>
                <img class="item-img3" src="/assets/img/food3.png" alt="아이템 3">

                <button id="Button3" class="item-button"><span style="color: #49ddfd">30</span> 포인트</button>
            </div>
            <div class="item">
                <div class="item-info">
                    <div class="item-description">수박</div>
                </div>
                <img class="item-img4" src="/assets/img/food4.png" alt="아이템 4">

                <button id="Button4" class="item-button"><span style="color: #49ddfd">100</span> 포인트</button>
            </div>
        </div>
        <div class="myPet" style="position: relative;">
            <div class="swiper mySwiper">
                <h2 id="required-level" style="font-family: 'NIXGONM-Vb'; color: #ffffff; font-weight: normal;"></h2>

                <div id="turtleMessage" style="color: #5dfa32;"></div>
                <img id="turtleImage" alt="" style="width: 70%; position: absolute; top:160px; left: 30px">
                <div style="height: 150px;"></div>
                <div class="exp-bar-outer" style="margin-top: 15px; margin-bottom: 20px">
                    <div class="exp-bar-inner" id="expBar"></div>
                </div>
                <div class="points-display" style="font-size: 17px;">
                    <div><[[${rDTO.userName}]]님의 파트너></div>
                    <div>정상 자세 포인트: <span id="current-gold"><span style="color: #49ddfd">[[${rDTO.point}]]</span>포인트</span></div>
                    <div>현재 경험치: <span id="current-exp" style="color: #5dfa32"></span> / <span id="required-exp"></span></div>
                </div>
            </div>
        </div>
    </div>


</section>

<form id="postureDataForm">
    <input type="hidden" name="point" id="hiddenPoint" value="0">
    <input type="hidden" name="exp" id="hiddenExp" value="0">
</form>

<script>
    let currentExp = [[${rDTO.exp}]];
    var expSpan = document.getElementById("required-exp");
    var levelSpan = document.getElementById("required-level");
    var turtleImage = document.getElementById("turtleImage");
    let requiredExp = 1;

    if (currentExp >= 0 && currentExp < 15) {
        requiredExp = 15;
        expSpan.innerHTML = "15";
        turtleImage.src = "/assets/img/turtlelv1.gif";
        turtleImage.style.top = "130px";
        levelSpan.innerHTML = "Lv. 1 <span style='color: #5dfa32'>새싹거북</span>";
        document.getElementById('current-exp').textContent = currentExp;
    } else if (currentExp > 14 && currentExp < 65) {
        currentExp -= 15;
        requiredExp = 50;
        expSpan.innerHTML = "50";
        levelSpan.innerHTML = "Lv. 2 <span style='color: #ff6434'>거북게</span>";
        turtleImage.src = "/assets/img/turtlelv2.gif";
        document.getElementById('current-exp').textContent = currentExp;
    } else if (currentExp > 64 && currentExp < 365) {
        currentExp -= 65;
        requiredExp = 300;
        expSpan.innerHTML = "300";
        levelSpan.innerHTML = "Lv. 3 <span style='color: #34e1ff'>천사거북</span>";
        turtleImage.src = "/assets/img/turtlelv3.gif";
        document.getElementById('current-exp').textContent = currentExp;
    } else if (currentExp > 364 && currentExp < 1365) {
        currentExp -= 365;
        requiredExp = 1000;
        expSpan.innerHTML = "1000";
        levelSpan.innerHTML = "Lv. 4 <span style='color: #3e88fa'>아이스거북</span>";
        turtleImage.src = "/assets/img/turtlelv4.gif";
        document.getElementById('current-exp').textContent = currentExp;
    } else if (currentExp > 1364 && currentExp < 6365) {
        currentExp -= 1365;
        requiredExp = 5000;
        expSpan.innerHTML = "5000";
        levelSpan.innerHTML = "Lv. 5 <span style='color: #20bd7d'>이끼거북</span>";
        turtleImage.src = "/assets/img/turtlelv5.gif";
        document.getElementById('current-exp').textContent = currentExp;
    } else if (currentExp > 6364) {
        currentExp -= 6365;
        requiredExp = 100000;
        expSpan.innerHTML = "100000";
        levelSpan.innerHTML = "Lv. 6 <span style='color: #fdc512'>거북왕</span>";
        turtleImage.src = "/assets/img/turtlelv6.gif";
        turtleImage.style.top = "150px";
        document.getElementById('current-exp').textContent = currentExp;
    }



    var exp = (currentExp / requiredExp) * 100;

    function updateExpBar(exp) {
        var expBar = document.getElementById("expBar");
        expBar.style.width = exp + '%';
    }

    updateExpBar(exp);
</script>

<script src="/js/jquery.js"></script>
<script type="text/javascript" src="/js/jquery.mixitup.js"></script>
<script type="text/javascript" src="/js/bootstrap.js"></script>
<script type="text/javascript" src="/js/modernizr.custom.js"></script>
<script type="text/javascript" src="/js/jquery.bxslider.js"></script>
<script type="text/javascript" src="/js/jquery.cslider.js"></script>
<script type="text/javascript" src="/js/jquery.placeholder.js"></script>
<script type="text/javascript" src="/js/jquery.inview.js"></script>
<script src="/js/respond.min.js"></script>
<script type="text/javascript" src="/js/app.js"></script>
</body>
</html>