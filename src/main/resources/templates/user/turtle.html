<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>거북이 키우기</title>
    <script type="text/javascript" src="/js/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/turtle.css"/>
    <style>

    </style>
    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#Button1").on("click", function () {
                doSubmit1();
            })

            $("#Button2").on("click", function () {
                doSubmit2();
            })

            $("#Button3").on("click", function () {
                doSubmit3();
            })

            $("#Button4").on("click", function () {
                doSubmit4();
            })
        })
        function doSubmit1() {

            document.getElementById('hiddenPoint').value = 1;
            document.getElementById('hiddenExp').value = 5;

            if ([[${rDTO.point}]] < 1) {
                alert("포인트가 부족합니다.");
                return;
            }

            // AJAX 요청을 통해 서버로 데이터를 전송합니다.
            $.ajax({
                url: "/user/expUpdate",
                type: "post",
                dataType: "JSON",
                data: $("#postureDataForm").serialize(),
                success: function (json) {
                    showHappyMessage();
                    addFeedEffect();
                }
            });
        };

        function doSubmit2() {

            document.getElementById('hiddenPoint').value = 5;
            document.getElementById('hiddenExp').value = 25;

            if ([[${rDTO.point}]] < 5) {
                alert("포인트가 부족합니다.");
                return;
            }

            // AJAX 요청을 통해 서버로 데이터를 전송합니다.
            $.ajax({
                url: "/user/expUpdate",
                type: "post",
                dataType: "JSON",
                data: $("#postureDataForm").serialize(),
                success: function (json) {
                    addFeedEffect2();
                }
            });
        };

        function doSubmit3() {

            document.getElementById('hiddenPoint').value = 30;
            document.getElementById('hiddenExp').value = 150;

            if ([[${rDTO.point}]] < 30) {
                alert("포인트가 부족합니다.");
                return;
            }

            // AJAX 요청을 통해 서버로 데이터를 전송합니다.
            $.ajax({
                url: "/user/expUpdate",
                type: "post",
                dataType: "JSON",
                data: $("#postureDataForm").serialize(),
                success: function (json) {
                    addFeedEffect();
                }
            });
        };

        function doSubmit4() {

            document.getElementById('hiddenPoint').value = 100;
            document.getElementById('hiddenExp').value = 500;

            if ([[${rDTO.point}]] < 100) {
                alert("포인트가 부족합니다.");
                return;
            }

            // AJAX 요청을 통해 서버로 데이터를 전송합니다.
            $.ajax({
                url: "/user/expUpdate",
                type: "post",
                dataType: "JSON",
                data: $("#postureDataForm").serialize(),
                success: function (json) {
                    addFeedEffect();
                }
            });
        };

        function showHappyMessage() {
            var messageDiv = document.getElementById("turtleMessage");
            messageDiv.innerHTML = "거북이가 행복해합니다! (+5 경험치!)";
            // 메시지를 표시하는 동안 클래스 추가하여 스타일 적용 가능
            messageDiv.classList.add("happyMessageStyle");
        }



    </script>
    <script src="/js/turtle.js"></script>
</head>
<body>
<section>
    <div class="content">
        <div class="item-list">
            <div class="item">
                <div class="item-info">
                    <div class="item-description">시금치</div>
                </div>
                <img class="item-img" src="/assets/img/food1.png" alt="아이템 1">

                <button id="Button1" class="item-button"><span style="color: #49ddfd">1</span> 포인트</button>
            </div>
            <div class="item">
                <div class="item-info">
                    <div class="item-description">브로콜리</div>
                </div>
                <img class="item-img2" src="/assets/img/food2.png" alt="아이템 2">

                <button id="Button2" class="item-button"><span style="color: #49ddfd">5</span> 포인트</button>
            </div>
            <div class="item">
                <div class="item-info">
                    <div class="item-description">샤인머스켓</div>
                </div>
                <img src="/assets/img/food3.png" alt="아이템 3">

                <button id="Button3" class="item-button"><span style="color: #49ddfd">30</span> 포인트</button>
            </div>
            <div class="item">
                <div class="item-info">
                    <div class="item-description">수박</div>
                </div>
                <img src="/assets/img/food4.png" alt="아이템 4">

                <button id="Button4" class="item-button"><span style="color: #49ddfd">100</span> 포인트</button>
            </div>
        </div>
        <div class="myPet">
            <div class="swiper mySwiper">
                <h2 id="required-level" style="font-family: 'NIXGONM-Vb'; color: #ffffff; font-weight: normal"></h2>

                <div id="turtleMessage" style="color: #5dfa32"></div>
                <img id="turtleImage" alt="" style="width: 70%; margin-top: 70px; margin-left: 45px">
                <div class="exp-bar-outer" style="margin-top: 15px; margin-bottom: 20px">
                    <div class="exp-bar-inner" id="expBar"></div>
                </div>
                <div class="points-display" style="font-size: 17px;">
                    <div><[[${rDTO.userName}]]님의 거북이></div>
                    <div>보유 포인트: <span id="current-gold"><span style="color: #49ddfd">[[${rDTO.point}]]</span>포인트</span></div>
                    <div>현재 경험치: <span id="current-exp" style="color: #5dfa32">[[${rDTO.exp}]]</span> / <span id="required-exp"></span></div>
                </div>
            </div>
        </div>
    </div>

    <ul class="circles">
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>
</section>

<form id="postureDataForm">
    <input type="hidden" name="point" id="hiddenPoint" value="0">
    <input type="hidden" name="exp" id="hiddenExp" value="0">
</form>

<script>
    let currentExp = [[${rDTO.exp}]];
    var expSpan = document.getElementById("required-exp");
    var levelSpan = document.getElementById("required-level");
    var turtleImage = document.getElementById("turtleImage");
    let requiredExp = 1;

    if (currentExp >= 0 && currentExp < 15) {
        requiredExp = 15;
        expSpan.innerHTML = "15";
        levelSpan.innerHTML = "Lv. 1 <span style='color: #5dfa32'>새싹거북</span>";
        turtleImage.src = "/assets/img/turtleg2.gif";
    } else if (currentExp > 14 && currentExp < 60) {
        requiredExp = 60;
        expSpan.innerHTML = "60";
        levelSpan.innerHTML = "Lv. 2 <span style='color: #ff6434'>거북게</span>";
        turtleImage.src = "/assets/img/turtlelv2.gif";
    } else if (currentExp > 59 && currentExp < 300) {
        requiredExp = 300;
        expSpan.innerHTML = "300";
        levelSpan.innerHTML = "Lv. 3 <span style='color: #34e1ff'>날개거북</span>";
    } else if (currentExp > 299 && currentExp < 1000) {
        requiredExp = 1000;
        expSpan.innerHTML = "1000";
    } else if (currentExp > 999 && currentExp < 10000) {
        requiredExp = 10000;
        expSpan.innerHTML = "10000";
    }

    var exp = (currentExp / requiredExp) * 100;

    function updateExpBar(exp) {
        var expBar = document.getElementById("expBar");
        expBar.style.width = exp + '%';
    }

    updateExpBar(exp);
</script>

</body>
</html>